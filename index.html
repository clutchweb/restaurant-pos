<style>
    .item-box,
    .modal-content {
      margin-top: 20px;
      background: #fff;
      padding: 10px;
      border-radius: 6px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      position: relative;
      opacity: 0;
      transform: scale(0.95);
      transition: all 0.3s ease-in-out;
    }
    .item-box.show,
    .modal-content.show {
      display: block !important;
      opacity: 1;
      transform: scale(1);
    }
    .discount-btn {
      background-color: #2ecc71;
      color: white;
      border: none;
      border-radius: 4px;
      padding: 4px 8px;
      font-size: 1.2em;
      cursor: pointer;
      float: right;
      margin-top: -10px;
    }
</style>
<script>
    let currentCategory = '';
    let cart = [];
    let discountAmount = 0;
    let discountType = 'fixed';

    function showItems(category, color) {
      currentCategory = category;
      const box = document.getElementById('itemBox');
      const itemDiv = document.getElementById('itemButtons');
      const title = document.getElementById('itemBoxTitle');
      title.textContent = category;
      itemDiv.innerHTML = '';
      items[category].forEach(item => {
        const btn = document.createElement('button');
        btn.textContent = `${item.name} - $${item.price}`;
        btn.className = 'item-btn';
        btn.style.backgroundColor = color;
        btn.onclick = () => addToCart(item);
        itemDiv.appendChild(btn);
      });
      box.style.display = 'block';
      requestAnimationFrame(() => box.classList.add('show'));
    }

    function closeItemBox() {
      const box = document.getElementById('itemBox');
      box.classList.remove('show');
      setTimeout(() => box.style.display = 'none', 300);
    }

    function openManualEntry() {
      const modal = document.getElementById('manualModal');
      const content = modal.querySelector('.modal-content');
      modal.style.display = 'flex';
      requestAnimationFrame(() => content.classList.add('show'));
    }

    function closeManualEntry() {
      const modal = document.getElementById('manualModal');
      const content = modal.querySelector('.modal-content');
      content.classList.remove('show');
      setTimeout(() => modal.style.display = 'none', 300);
    }

    function checkout() {
      const method = document.getElementById('paymentMethod').value;
      if (cart.length === 0) return alert('Cart is empty');
      if (method === 'Cash') {
        const modal = document.getElementById('cashInputContainer');
        const content = modal.querySelector('.modal-content');
        modal.style.display = 'flex';
        requestAnimationFrame(() => content.classList.add('show'));
      } else {
        generateReceipt('Card', 0);
      }
    }

    function closeCashInput() {
      const modal = document.getElementById('cashInputContainer');
      const content = modal.querySelector('.modal-content');
      content.classList.remove('show');
      setTimeout(() => modal.style.display = 'none', 300);
    }

    function openDiscountPrompt() {
      const type = prompt("Type 'amount' for fixed discount or '%' for percentage:");
      if (!type) return;
      const value = prompt("Enter discount value:");
      const num = parseFloat(value);
      if (!isNaN(num) && num > 0) {
        discountAmount = num;
        discountType = type.includes('%') ? 'percent' : 'fixed';
        updateCart();
      }
    }

    function resetDiscount() {
      discountAmount = 0;
      discountType = 'fixed';
      updateCart();
    }

    function updateCart() {
      const cartBody = document.getElementById('cartItems');
      cartBody.innerHTML = '';
      let total = 0;
      cart.forEach((item, index) => {
        const row = document.createElement('tr');
        row.innerHTML = `<td>${item.name}</td><td>$${parseFloat(item.price).toFixed(2)}</td><td><button class='remove-btn' onclick='removeFromCart(${index})'>×</button></td>`;
        cartBody.appendChild(row);
        total += parseFloat(item.price);
      });
      let discountValue = 0;
      if (discountAmount > 0) {
        discountValue = discountType === 'percent' ? total * (discountAmount / 100) : discountAmount;
        const discountRow = document.createElement('tr');
        discountRow.innerHTML = `<td><em>Discount (${discountType === 'percent' ? discountAmount + '%' : '$' + discountAmount.toFixed(2)})</em></td><td>-$${discountValue.toFixed(2)}</td><td><button class='remove-btn' onclick='resetDiscount()'>×</button></td>`;
        cartBody.appendChild(discountRow);
      }
      document.getElementById('totalAmount').innerText = `$${Math.max(0, total - discountValue).toFixed(2)}`;
    }

    function generateReceipt(method, change) {
      const win = window.open('', '', 'width=400,height=600');
      const now = new Date();
      let content = `<h1 style='text-align:center;'>The Titanic</h1><hr><pre>`;
      content += `Date: ${now.toLocaleDateString()}\nTime: ${now.toLocaleTimeString()}\n\nItems:\n`;
      cart.forEach(item => content += `${item.name.padEnd(20)} $${parseFloat(item.price).toFixed(2)}\n`);
      let total = cart.reduce((sum, i) => sum + parseFloat(i.price), 0);
      let discountLine = '';
      let discountValue = 0;
      if (discountAmount > 0) {
        discountValue = discountType === 'percent' ? total * (discountAmount / 100) : discountAmount;
        discountLine = `Discount (${discountType === 'percent' ? discountAmount + '%' : '$' + discountAmount.toFixed(2)}): -$${discountValue.toFixed(2)}\n`;
        total -= discountValue;
      }
      content += `\n${discountLine}`;
      content += `Total:               $${Math.max(0, total).toFixed(2)}\nPayment Method:      ${method}\n`;
      if (method === 'Cash') content += `Change:              $${change.toFixed(2)}\n`;
      content += `</pre><hr><p style='text-align:center;'>Thank you!</p>`;
      content += `<div style='text-align:center;'><button onclick='window.print()'>Print Receipt</button></div>`;
      win.document.write(content);
      win.document.close();
      cart = [];
      discountAmount = 0;
      discountType = 'fixed';
      updateCart();
    }
</script>
<button class="discount-btn" onclick="openDiscountPrompt()">＋</button>
